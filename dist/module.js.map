{"version":3,"sources":["../src/module.js"],"names":["StatisticsCtrl","$scope","$injector","$location","linkSrv","remote_server","base_path","plugin_path","dataType","series","data","fontSizes","fontSizesInt","unitFormats","invalidGaugeRange","valueNameOptions","value","text","iconTypesOptions","panelDefaults","links","datasource","maxDataPoints","interval","targets","cacheTimeout","format","prefix","postfix","nullText","valueMaps","op","mappingTypes","name","rangeMaps","from","to","mappingType","nullPointMode","valueName","prefixFontSize","valueFontSize","postfixFontSize","thresholds","colorBackground","colorValue","colors","sparkline","show","full","lineColor","fillColor","gauge","minValue","maxValue","thresholdMarkers","thresholdLabels","trendIndicator","size","tableColumn","subtitle","iconType","allowActuation","defaultsDeep","panel","initModalValues","events","on","onDataReceived","bind","onDataError","onInitEditMode","onSparklineColorChange","onSparklineFillChange","handleClickActuation","showActuationModal","handleClickTitle","showDetailsModal","handleSendToRemote","sendToRemote","modal","allowedEntities","allowedTypes","entity","type","valid","values","getDetailsModalValues","processTargets","modalScope","$new","publishAppEvent","src","modalClass","scope","initDetailModalValues","column","undefined","validFieldValues","processResponse","url","replace","console","info","fetch","method","mode","body","JSON","stringify","headers","Headers","request_header","then","response","ok","catch","error","warn","msg","document","querySelector","innerHTML","addEditorTab","getUnitFormats","subItem","refresh","err","dataList","debug","length","tableData","map","tableHandler","setTableValues","seriesHandler","setValues","render","seriesData","datapoints","alias","target","flotpairs","getFlotPairs","columnNames","columns","forEach","columnIndex","tableColumnOptions","find","setTableColumnToSensibleDefault","rows","datapoint","row","key","push","col","isString","valueFormatted","escape","valueRounded","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","decimals","scaledDecimals","roundValue","setValueMapping","options","background","tmp","panelColorIndex","color","newColor","isNumber","delta","dec","Math","floor","log","LN10","magn","pow","norm","result","max","Error","message","lastPoint","last","lastValue","isArray","stats","scopedVars","extend","label","i","parseFloat","index","indexOf","splice","rangeMap","lines_total","cols_total","pair","c","l","elem","attrs","ctrl","$timeout","templateSrv","linkInfo","$panelContainer","applyColoringThresholds","valueString","getColorForValue","getDiv","className","fontSize","content","spanContent","getTrendIndicator","trendIndicatorValue","icon","getBigValueHtml","getValueText","addGauge","width","height","dimension","min","plotCanvas","plotCss","top","margin","position","css","colorMap","bgColor","bootData","user","lightTheme","fontScale","parseInt","gaugeWidthReduceRatio","gaugeWidth","thresholdMarkersWidth","thresholdLabelFontSize","gauges","border","shadow","frame","layout","thresholdWidth","cell","threshold","font","formatter","family","append","plotSeries","plot","addSparkline","setTimeout","bottom","left","dynamicHeightMargin","round","legend","lines","fill","lineWidth","yaxes","xaxis","range","valueOf","grid","hoverable","setPanelBackground","fullscreen","split","strVale","Number","trim","html","toggleClass","hookupDrilldownLinkTooltip","drilldownTooltip","mouseleave","detach","click","evt","parents","window","open","href","location","mousemove","e","title","place_tt","pageX","pageY","renderingCompleted","isFinite","first","whereClauses","filter","operator","metrics","metricAggs","entities","fields","templateUrl","PanelCtrl"],"mappings":"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","file":"module.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'vendor/flot/jquery.flot.js';\nimport 'vendor/flot/jquery.flot.time.js';\nimport 'vendor/flot/jquery.flot.gauge.js';\n//grafana specific\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\nimport TimeSeries from 'app/core/time_series2';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\n//plugin specific\nimport definitions from './definitions';\nimport './styles/panel.css!';\n\nclass StatisticsCtrl extends MetricsPanelCtrl {\n\n  /** @ngInject */\n  constructor($scope, $injector, $location, linkSrv) {\n    super($scope, $injector);\n\n    this.remote_server = definitions.remote_server;\n    this.base_path = definitions.plugin_path;\n    this.dataType = 'timeseries';\n    this.series = [];\n    this.data = [];\n    this.fontSizes = [];\n    this.fontSizesInt = [];\n    this.unitFormats = [];\n    this.invalidGaugeRange = false;\n\n    this.valueNameOptions = [\n        { value: 'min', text: 'Min' },\n        { value: 'max', text: 'Max' },\n        { value: 'avg', text: 'Average' },\n        { value: 'current', text: 'Current' },\n        { value: 'total', text: 'Total' },\n        { value: 'name', text: 'Name' },\n        { value: 'first', text: 'First' },\n        { value: 'delta', text: 'Delta' },\n        { value: 'diff', text: 'Difference' },\n        { value: 'range', text: 'Range' },\n        { value: 'last_time', text: 'Time of last point' },\n    ];\n\n    this.iconTypesOptions = [\n      'none',\n      'info-circle', 'save', 'editor', 'controller', 'exclamation-triangle',\n      'fighter-jet', 'file', 'home', 'inbox', 'leaf', 'map-marker', 'motorcycle',\n      'plane', 'recycle', 'taxi', 'subway', 'table', 'thermometer-half',\n       'tree', 'trash', 'truck', 'umbrella', 'volume-up']\n\n    // Set and populate defaults\n    this.panelDefaults = {\n      links: [],\n      datasource: null,\n      maxDataPoints: 100,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      format: 'none',\n      prefix: '',\n      postfix: '',\n      nullText: null,\n      valueMaps: [{ value: 'null', op: '=', text: 'N/A' }],\n      mappingTypes: [{ name: 'value to text', value: 1 }, { name: 'range to text', value: 2 }],\n      rangeMaps: [{ from: 'null', to: 'null', text: 'N/A' }],\n      mappingType: 1,\n      nullPointMode: 'connected',\n      valueName: 'avg',\n      prefixFontSize: '50%',\n      valueFontSize: '80%',\n      postfixFontSize: '50%',\n      thresholds: '',\n      colorBackground: false,\n      colorValue: false,\n      colors: ['#299c46', 'rgba(237, 129, 40, 0.89)', '#d44a3a'],\n      sparkline: {\n        show: false,\n        full: false,\n        lineColor: 'rgb(31, 120, 193)',\n        fillColor: 'rgba(31, 118, 189, 0.18)',\n      },\n      gauge: {\n        show: false,\n        minValue: 0,\n        maxValue: 100,\n        thresholdMarkers: true,\n        thresholdLabels: false,\n      },\n      trendIndicator: {\n        show: false,\n        size: 30\n      },\n      tableColumn: '',\n      subtitle: 'NA',\n\n      iconType: '',\n      allowActuation: false,\n    };\n\n    _.defaultsDeep(this.panel, this.panelDefaults);\n\n    this.initModalValues();\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.onSparklineColorChange = this.onSparklineColorChange.bind(this);\n    this.onSparklineFillChange = this.onSparklineFillChange.bind(this);\n\n    this.handleClickActuation = this.showActuationModal.bind(this);\n    this.handleClickTitle = this.showDetailsModal.bind(this);\n    this.handleSendToRemote = this.sendToRemote.bind(this);\n  }\n\n  initModalValues() {\n    this.modal = {\n      allowedEntities: [],\n      allowedTypes: [],\n      entity: {},\n      type: {},\n      value: '',\n      valid: false\n    }\n  }\n\n  initDetailModalValues() {\n    this.modal = { values: this.getDetailsModalValues() }\n  }\n\n  showActuationModal() {\n    if(!this.panel.allowActuation)\n      return ;\n\n    this.initModalValues();\n\n    [this.modal.allowedEntities, this.modal.allowedTypes] = processTargets(this.panel.targets)\n    let modalScope = this.$scope.$new();\n    modalScope.panel = this.panel;\n\n    this.publishAppEvent('show-modal', {\n      src: this.base_path+'partials/modal_actuation.html',\n      modalClass: 'confirm-modal',\n      scope: modalScope,\n    });\n  }\n\n  showDetailsModal() {\n\n    this.initDetailModalValues();\n\n    let modalScope = this.$scope.$new();\n    modalScope.panel = this.panel;\n\n    this.publishAppEvent('show-modal', {\n      src: this.base_path+'partials/modal_details.html',\n      modalClass: 'confirm-modal',\n      scope: modalScope,\n    });\n  }\n\n  validFieldValues() {\n    return (this.modal.type.column!==undefined && this.modal.entity.value!==undefined && this.modal.value!==undefined && this.modal.value!=='')\n  }\n\n  sendToRemote() {\n    this.modal.valid=this.validFieldValues()\n    if(!this.modal.valid) {\n      processResponse('warning', 'Please, choose or set all fields!')\n      return ;\n    }\n\n    let url = definitions.remote_server.replace('<device_id>', this.modal.entity.value);\n    let data = {}\n    data[this.modal.type.column] = this.modal.value\n    console.info(url)\n    console.info(data)\n    fetch(url, {\n      method: 'POST',\n      mode: 'cors', // no-cors, cors, *same-origin\n      body: JSON.stringify(data), // data can be `string` or {object}!\n      headers: new Headers(definitions.request_header)\n    })\n    .then((response) => {\n      if(response.ok) {\n        console.info('Success:', response)\n        processResponse('success', 'Successfuly updated!')\n      } else\n        processResponse('warning', 'Error updating!')\n    })\n    .catch((error) => {\n      console.warn('Error:', error)\n      processResponse('warning', error)\n    })\n\n    function processResponse(type, msg) {\n      document.querySelector('.modal-content > .server-response').innerHTML=`<div class='alert alert-${type} fade in alert-dismissible'>${msg}</div>`\n    }\n  }\n\n  onInitEditMode() {\n    this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\n    this.fontSizesInt = [10, 30, 50, 70, 80, 100, 110, 120];\n    this.addEditorTab('Options', `${definitions.plugin_path}partials/editor.html`, 2);\n    this.addEditorTab('Value Mappings', `${definitions.plugin_path}partials/mappings.html`, 3);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.refresh();\n  }\n\n  onDataError(err) {\n    this.onDataReceived([]);\n  }\n\n  onDataReceived(dataList) {\n    if(!dataList) {\n      console.debug('No data recieved')\n      return ;\n    }\n\n    if(dataList.length === 0) {\n      console.debug('No dataList recieved')\n      return ;\n    }\n\n    let data = {};\n    if (dataList.length > 0 && dataList[0].type === 'table') {\n      this.dataType = 'table';\n      const tableData = dataList.map(this.tableHandler.bind(this));\n      this.setTableValues(tableData, data);\n    } else {\n      this.dataType = 'timeseries';\n      this.series = dataList.map(this.seriesHandler.bind(this));\n      this.setValues(data);\n    }\n\n    this.data = data;\n    console.debug(this.data)\n    this.render();\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints || [],\n      alias: seriesData.target,\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  tableHandler(tableData) {\n    const datapoints = [];\n    const columnNames = {};\n\n    tableData.columns.forEach((column, columnIndex) => {\n      columnNames[columnIndex] = column.text;\n    });\n\n    this.tableColumnOptions = columnNames;\n    if (!_.find(tableData.columns, ['text', this.panel.tableColumn])) {\n      this.setTableColumnToSensibleDefault(tableData);\n    }\n\n    tableData.rows.forEach(row => {\n      const datapoint = {};\n\n      row.forEach((value, columnIndex) => {\n        const key = columnNames[columnIndex];\n        datapoint[key] = value;\n      });\n\n      datapoints.push(datapoint);\n    });\n\n    return datapoints;\n  }\n\n  setTableColumnToSensibleDefault(tableData) {\n    if (this.tableColumnOptions.length === 1) {\n      this.panel.tableColumn = this.tableColumnOptions[0];\n    } else {\n      this.panel.tableColumn = _.find(tableData.columns, col => {\n        return col.type !== 'time';\n      }).text;\n    }\n  }\n\n  setTableValues(tableData, data) {\n    if (!tableData || tableData.length === 0) {\n      return;\n    }\n\n    if (tableData[0].length === 0 || tableData[0][0][this.panel.tableColumn] === undefined) {\n      return;\n    }\n\n    const datapoint = tableData[0][0];\n    data.value = datapoint[this.panel.tableColumn];\n\n    if (_.isString(data.value)) {\n      data.valueFormatted = _.escape(data.value);\n      data.value = 0;\n      data.valueRounded = 0;\n    } else {\n      const decimalInfo = this.getDecimalsForValue(data.value);\n      const formatFunc = kbn.valueFormats[this.panel.format];\n      data.valueFormatted = formatFunc(\n        datapoint[this.panel.tableColumn],\n        decimalInfo.decimals,\n        decimalInfo.scaledDecimals\n      );\n      data.valueRounded = kbn.roundValue(data.value, this.panel.decimals || 0);\n    }\n\n    this.setValueMapping(data);\n  }\n\n  canChangeFontSize() {\n    return this.panel.gauge.show;\n  }\n\n  setColoring(options) {\n    if (options.background) {\n      this.panel.colorValue = false;\n      this.panel.colors = ['rgba(71, 212, 59, 0.4)', 'rgba(245, 150, 40, 0.73)', 'rgba(225, 40, 40, 0.59)'];\n    } else {\n      this.panel.colorBackground = false;\n      this.panel.colors = ['rgba(50, 172, 45, 0.97)', 'rgba(237, 129, 40, 0.89)', 'rgba(245, 54, 54, 0.9)'];\n    }\n    this.render();\n  }\n\n  invertColorOrder() {\n    var tmp = this.panel.colors[0];\n    this.panel.colors[0] = this.panel.colors[2];\n    this.panel.colors[2] = tmp;\n    this.render();\n  }\n\n  onColorChange(panelColorIndex) {\n    return color => {\n      this.panel.colors[panelColorIndex] = color;\n      this.render();\n    };\n  }\n\n  onSparklineColorChange(newColor) {\n    this.panel.sparkline.lineColor = newColor;\n    this.render();\n  }\n\n  onSparklineFillChange(newColor) {\n    this.panel.sparkline.fillColor = newColor;\n    this.render();\n  }\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return { decimals: this.panel.decimals, scaledDecimals: null };\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec),\n      norm = delta / magn, // norm is between 1.0 and 10.0\n      size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) {\n      dec = 0;\n    }\n\n    let result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n    return result;\n  }\n\n  setValues(data) {\n    data.flotpairs = [];\n\n    console.log('setValues...')\n    console.log(this.series)\n\n\n    if (this.series.length === 0) {\n      let error = new Error();\n      error.message = 'No Series Error';\n      error.data =\n        'Metric query returns ' +\n        this.series.length +\n        ' series. Single Stat Panel expects a series.\\n\\nResponse:\\n' +\n        JSON.stringify(this.series);\n      throw error;\n    }\n\n    if (this.series && this.series.length > 0) {\n      if (this.series.length > 1){\n        console.log('=> multiple series: #'+this.series.length)\n\n      }\n\n      let lastPoint = _.last(this.series[0].datapoints);\n      let lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\n\n      if (this.panel.valueName === 'name') {\n        data.value = 0;\n        data.valueRounded = 0;\n        data.valueFormatted = this.series[0].alias;\n      } else if (_.isString(lastValue)) {\n        data.value = 0;\n        data.valueFormatted = _.escape(lastValue);\n        data.valueRounded = 0;\n      } else if (this.panel.valueName === 'last_time') {\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        data.value = lastPoint[1];\n        data.valueRounded = data.value;\n        data.valueFormatted = formatFunc(data.value, 0, 0);\n      } else {\n        data.value = this.series[0].stats[this.panel.valueName];\n        data.flotpairs = this.series[0].flotpairs;\n\n        let decimalInfo = this.getDecimalsForValue(data.value);\n        let formatFunc = kbn.valueFormats[this.panel.format];\n        data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n        data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\n      }\n\n      // Add $__name variable for using in prefix or postfix\n      data.scopedVars = _.extend({}, this.panel.scopedVars);\n      data.scopedVars['__name'] = { value: this.series[0].label };\n    }\n    this.setValueMapping(data);\n  }\n\n  setValueMapping(data) {\n    // check value to text mappings if its enabled\n    if (this.panel.mappingType === 1) {\n      for (let i = 0; i < this.panel.valueMaps.length; i++) {\n        let map = this.panel.valueMaps[i];\n        // special null case\n        if (map.value === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = map.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to text mapping\n        var value = parseFloat(map.value);\n        if (value === data.valueRounded) {\n          data.valueFormatted = map.text;\n          return;\n        }\n      }\n    } else if (this.panel.mappingType === 2) {\n      for (let i = 0; i < this.panel.rangeMaps.length; i++) {\n        let map = this.panel.rangeMaps[i];\n        // special null case\n        if (map.from === 'null' && map.to === 'null') {\n          if (data.value === null || data.value === void 0) {\n            data.valueFormatted = map.text;\n            return;\n          }\n          continue;\n        }\n\n        // value/number to range mapping\n        var from = parseFloat(map.from);\n        var to = parseFloat(map.to);\n        if (to >= data.valueRounded && from <= data.valueRounded) {\n          data.valueFormatted = map.text;\n          return;\n        }\n      }\n    }\n\n    if (data.value === null || data.value === void 0) {\n      data.valueFormatted = 'no value';\n    }\n  }\n\n  removeValueMap(map) {\n    var index = _.indexOf(this.panel.valueMaps, map);\n    this.panel.valueMaps.splice(index, 1);\n    this.render();\n  }\n\n  addValueMap() {\n    this.panel.valueMaps.push({ value: '', op: '=', text: '' });\n  }\n\n  removeRangeMap(rangeMap) {\n    var index = _.indexOf(this.panel.rangeMaps, rangeMap);\n    this.panel.rangeMaps.splice(index, 1);\n    this.render();\n  }\n\n  addRangeMap() {\n    this.panel.rangeMaps.push({ from: '', to: '', text: '' });\n  }\n\n  getDetailsModalValues() {\n    if(!this.series[0].datapoints)\n      return ;\n    let lines_total = this.series.length\n    let cols_total = this.series[0].datapoints.length\n\n    let result = []\n    let pair = null\n\n    for(let c=0; c<cols_total; c++) {\n      pair = {}\n      for(let l=0; l<lines_total; l++) {\n        pair[this.series[l].alias||this.series[l].label] = this.series[l].datapoints[c][0]\n      }\n      result.push(pair)\n    }\n\n    return result\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    let $location = this.$location;\n    let linkSrv = this.linkSrv;\n    let $timeout = this.$timeout;\n    let panel = ctrl.panel;\n    let templateSrv = this.templateSrv;\n    let data, linkInfo;\n\n    let $panelContainer = elem.find('.panel-container');\n    elem = elem.find('.statistics-panel-value-container');\n\n    function applyColoringThresholds(value, valueString) {\n      if (!panel.colorValue) {\n        return valueString;\n      }\n\n      var color = getColorForValue(data, value);\n      if (color) {\n        return '<span style=\"color:' + color + '\">' + valueString + '</span>';\n      }\n\n      return valueString;\n    }\n\n    function getDiv(className, fontSize, content) {\n      content = templateSrv.replace(content, data.scopedVars);\n      let spanContent = '<div class=\"' + className;\n      if(fontSize)\n        spanContent += '\" style=\"font-size:' + fontSize;\n\n      spanContent += '\">' + content + '</div>';\n      return spanContent;\n    }\n\n    function getTrendIndicator() {\n      //probably the 'Format as' is of type 'table'. 'table' is not supported\n      if(!data.flotpairs && data.flotpairs.length<=1) {\n        console.info('Unable to show trend. Please, choose other interval or verify the resultset.');\n        return `<span></span>`;\n      }\n\n      console.debug(`first value: ${data.flotpairs[0][1]}, last value: ${data.flotpairs[data.flotpairs.length-1][1]}`)\n      let trendIndicatorValue = data.flotpairs[data.flotpairs.length-1][1]-data.flotpairs[0][1]\n      let icon;\n\n      console.debug(`trendIndicatorValue: ${trendIndicatorValue}`)\n\n      if(trendIndicatorValue<0)\n        icon = 'fa-arrow-down';\n      else if(trendIndicatorValue>0)\n        icon = 'fa-arrow-up';\n      else\n        icon = 'fa-arrow-right';\n\n      return `<span><i class=\"fa ${icon}\"></i></span>`;\n    }\n\n    function getBigValueHtml() {\n      var body = '';\n\n      if (panel.prefix) {\n        var prefix = applyColoringThresholds(data.value, panel.prefix);\n        body += getDiv('statistics-panel-prefix', panel.prefixFontSize, prefix);\n      }\n\n      var value = applyColoringThresholds(data.value, data.valueFormatted);\n      body += getDiv('statistics-panel-value', panel.valueFontSize, value);\n\n      if (panel.postfix) {\n        var postfix = applyColoringThresholds(data.value, panel.postfix);\n        body += getDiv('statistics-panel-postfix', panel.postfixFontSize, postfix);\n      }\n\n      if (panel.trendIndicator.show) {\n        body += getDiv('statistics-panel-trendIndicator', `${panel.trendIndicator.size}px`, getTrendIndicator());\n      }\n\n\n      return body;\n    }\n\n    function getValueText() {\n      var result = panel.prefix ? templateSrv.replace(panel.prefix, data.scopedVars) : '';\n      result += data.valueFormatted;\n      result += panel.postfix ? templateSrv.replace(panel.postfix, data.scopedVars) : '';\n\n      return result;\n    }\n\n    function addGauge() {\n      var width = elem.width();\n      var height = elem.height();\n      // Allow to use a bit more space for wide gauges\n      var dimension = Math.min(width, height * 1.3);\n\n      ctrl.invalidGaugeRange = false;\n      if (panel.gauge.minValue > panel.gauge.maxValue) {\n        ctrl.invalidGaugeRange = true;\n        return;\n      }\n\n      var plotCanvas = $('<div></div>');\n      var plotCss = {\n        top: '10px',\n        margin: 'auto',\n        position: 'relative',\n        height: height * 0.9 + 'px',\n        width: dimension + 'px',\n      };\n\n      plotCanvas.css(plotCss);\n\n      var thresholds = [];\n      for (var i = 0; i < data.thresholds.length; i++) {\n        thresholds.push({\n          value: data.thresholds[i],\n          color: data.colorMap[i],\n        });\n      }\n      thresholds.push({\n        value: panel.gauge.maxValue,\n        color: data.colorMap[data.colorMap.length - 1],\n      });\n\n      var bgColor = config.bootData.user.lightTheme ? 'rgb(230,230,230)' : 'rgb(38,38,38)';\n\n      var fontScale = parseInt(panel.valueFontSize) / 100;\n      var fontSize = Math.min(dimension / 5, 100) * fontScale;\n      // Reduce gauge width if threshold labels enabled\n      var gaugeWidthReduceRatio = panel.gauge.thresholdLabels ? 1.5 : 1;\n      var gaugeWidth = Math.min(dimension / 6, 60) / gaugeWidthReduceRatio;\n      var thresholdMarkersWidth = gaugeWidth / 5;\n      var thresholdLabelFontSize = fontSize / 2.5;\n\n      var options = {\n        series: {\n          gauges: {\n            gauge: {\n              min: panel.gauge.minValue,\n              max: panel.gauge.maxValue,\n              background: { color: bgColor },\n              border: { color: null },\n              shadow: { show: false },\n              width: gaugeWidth,\n            },\n            frame: { show: false },\n            label: { show: false },\n            layout: { margin: 0, thresholdWidth: 0 },\n            cell: { border: { width: 0 } },\n            threshold: {\n              values: thresholds,\n              label: {\n                show: panel.gauge.thresholdLabels,\n                margin: thresholdMarkersWidth + 1,\n                font: { size: thresholdLabelFontSize },\n              },\n              show: panel.gauge.thresholdMarkers,\n              width: thresholdMarkersWidth,\n            },\n            value: {\n              color: panel.colorValue ? getColorForValue(data, data.valueRounded) : null,\n              formatter: function() {\n                return getValueText();\n              },\n              font: {\n                size: fontSize,\n                family: '\"Helvetica Neue\", Helvetica, Arial, sans-serif',\n              },\n            },\n            show: true,\n          },\n        },\n      };\n\n      elem.append(plotCanvas);\n\n      var plotSeries = {\n        data: [[0, data.valueRounded]],\n      };\n\n      $.plot(plotCanvas, [plotSeries], options);\n    }\n\n    function addSparkline() {\n      var width = elem.width() + 20;\n      if (width < 30) {\n        // element has not gotten it's width yet\n        // delay sparkline render\n        setTimeout(addSparkline, 30);\n        return;\n      }\n\n      var height = ctrl.height;\n      var plotCanvas = $('<div></div>');\n      var plotCss = {};\n      plotCss.position = 'absolute';\n\n      if (panel.sparkline.full) {\n        plotCss.bottom = '5px';\n        plotCss.left = '-5px';\n        plotCss.width = width - 10 + 'px';\n        var dynamicHeightMargin = height <= 100 ? 5 : Math.round(height / 100) * 15 + 5;\n        plotCss.height = height - dynamicHeightMargin + 'px';\n      } else {\n        plotCss.bottom = '0px';\n        plotCss.left = '-5px';\n        plotCss.width = width - 10 + 'px';\n        plotCss.height = Math.floor(height * 0.25) + 'px';\n      }\n\n      plotCanvas.css(plotCss);\n\n      var options = {\n        legend: { show: false },\n        series: {\n          lines: {\n            show: true,\n            fill: 1,\n            lineWidth: 1,\n            fillColor: panel.sparkline.fillColor,\n          },\n        },\n        yaxes: { show: false },\n        xaxis: {\n          show: false,\n          mode: 'time',\n          min: ctrl.range.from.valueOf(),\n          max: ctrl.range.to.valueOf(),\n        },\n        grid: { hoverable: false, show: false },\n      };\n\n      elem.append(plotCanvas);\n\n      var plotSeries = {\n        data: data.flotpairs,\n        color: panel.sparkline.lineColor,\n      };\n\n      $.plot(plotCanvas, [plotSeries], options);\n    }\n\n    function setPanelBackground() {\n      if (panel.colorBackground) {\n        var color = getColorForValue(data, data.value);\n        if (color) {\n          $panelContainer.css('background-color', color);\n          if (scope.fullscreen) {\n            elem.css('background-color', color);\n          } else {\n            elem.css('background-color', '');\n          }\n        }\n      } else {\n        $panelContainer.css('background-color', '');\n        elem.css('background-color', '');\n      }\n    }\n\n    function render() {\n\n      if(!ctrl.data || ctrl.data.length===0)\n        return;\n\n      data = ctrl.data;\n\n      // get thresholds\n      data.thresholds = panel.thresholds.split(',').map(function(strVale) {\n        return Number(strVale.trim());\n      });\n      data.colorMap = panel.colors;\n\n      setPanelBackground();\n\n      elem.html('')\n      !panel.gauge.show && elem.append(getBigValueHtml());\n      panel.sparkline.show && addSparkline();\n      panel.gauge.show && addGauge();\n\n      elem.toggleClass('pointer', panel.links.length > 0);\n\n      linkInfo = null;\n    }\n\n    function hookupDrilldownLinkTooltip() {\n      // drilldown link tooltip\n      var drilldownTooltip = $('<div id=\"tooltip\" class=\"\">hello</div>\"');\n\n      elem.mouseleave(function() {\n        if (panel.links.length === 0) {\n          return;\n        }\n        $timeout(function() {\n          drilldownTooltip.detach();\n        });\n      });\n\n      elem.click(function(evt) {\n        if (!linkInfo) {\n          return;\n        }\n        // ignore title clicks in title\n        if ($(evt).parents('.panel-header').length > 0) {\n          return;\n        }\n\n        if (linkInfo.target === '_blank') {\n          window.open(linkInfo.href, '_blank');\n          return;\n        }\n\n        if (linkInfo.href.indexOf('http') === 0) {\n          window.location.href = linkInfo.href;\n        } else {\n          $timeout(function() {\n            $location.url(linkInfo.href);\n          });\n        }\n\n        drilldownTooltip.detach();\n      });\n\n      elem.mousemove(function(e) {\n        if (!linkInfo) {\n          return;\n        }\n\n        drilldownTooltip.text('click to go to: ' + linkInfo.title);\n        drilldownTooltip.place_tt(e.pageX, e.pageY - 50);\n      });\n    }\n\n    hookupDrilldownLinkTooltip();\n\n    this.events.on('render', function() {\n      render();\n      ctrl.renderingCompleted();\n    });\n  }\n}\n\nfunction getColorForValue(data, value) {\n  if (!_.isFinite(value)) {\n    return null;\n  }\n  for (var i = data.thresholds.length; i > 0; i--) {\n    if (value >= data.thresholds[i - 1]) {\n      return data.colorMap[i];\n    }\n  }\n  return _.first(data.colorMap);\n}\n\nfunction processTargets(targets) {\n  let whereClauses = targets\n    .map(elem => elem.whereClauses\n    .filter(elem=>elem.operator==\"=\"))\n    .map(elem=>elem.map(({ column, value })=>({ column, value })))\n  let metrics = targets.map(elem=>elem.metricAggs\n    .filter(elem=>elem.type=='raw'))\n    .map(elem=>elem.map(({ column })=>({ column })))\n\n  let entities = whereClauses.length > 0 ? whereClauses[0].map(elem=>elem) : []\n  let fields = metrics.length > 0 ? metrics[0].map(elem=>elem) : []\n\n  return [entities, fields]\n}\n\nStatisticsCtrl.templateUrl = 'partials/module.html';\n\nexport { StatisticsCtrl, StatisticsCtrl as PanelCtrl, getColorForValue };\n"]}